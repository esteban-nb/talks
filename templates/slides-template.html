<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <!-- Add other metadata: author, data, keywords, but also generator and version -->

  <title>{{TITLE}}</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- Reveal.js core CSS -->
  <link rel="stylesheet" href="@dist/reset.css">
  <link rel="stylesheet" href="@dist/reveal.css">

  <!-- Custom assets -->
  <link rel="stylesheet" href="@assets/slides-style.css">

  <!-- Highlight.js code theme (default fallback) -->
  <link rel="stylesheet" href="@highlightjs/styles/github.min.css" id="highlight-theme">
</head>

<body data-theme="light">
  <!-- Toggle -->
  <div id="mode-toggle-container" title="Switch Theme">
    <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path class="frame frame-1"
        d="M9.225 18.412a1.595 1.595 0 0 1 -1.225 .588c-.468 0 -.914 -.214 -1.225 -.588l-4.361 -5.248a1.844 1.844 0 0 1 0 -2.328l4.361 -5.248a1.595 1.595 0 0 1 1.225 -.588c.468 0 .914 .214 1.225 .588l4.361 5.248a1.844 1.844 0 0 1 0 2.328l-4.361 5.248z" />
      <path class="frame frame-2" d="M17 5l4.586 5.836a1.844 1.844 0 0 1 0 2.328l-4.586 5.836" />
      <path class="frame frame-3" d="M13 5l4.586 5.836a1.844 1.844 0 0 1 0 2.328l-4.586 5.836" />
    </svg>
  </div>

  <div class="reveal">
    <div class="slides">
      <!-- TODO: add title and TOC slides -->
      {{CONTENT}}
      <!-- TODO: add closing slide -->
    </div>
  </div>

  <!-- Reveal.js core JS -->
  <script src="@dist/reveal.js"></script>

  <!-- Essential plugins -->
  <script src="@plugin/notes/notes.js"></script>
  <script src="@plugin/search/search.js"></script>
  <script src="@plugin/markdown/markdown.js"></script>
  <script src="@plugin/highlight/highlight.js"></script>
  <script src="@plugin/math/math.js"></script>
  <script src="@plugin/zoom/zoom.js"></script>

  <!-- Shared highlight.js engine -->
  <script src="@highlightjs/highlight.js"></script>

  <!-- Shared theme toggle logic -->
  <script src="@assets/ldm-toggle.js"></script>

  <!-- Highlight theme mode sync -->
  <script>
  (() => {
    const HIGHLIGHT_BY_MODE = {
      light: 'atom-one-light',
      mono:  'googlecode',
      dark:  'ir-black'
    };

    const link = document.getElementById('highlight-theme');

    function applyHighlightTheme(mode) {
      const theme = HIGHLIGHT_BY_MODE[mode];
      if (!theme) return;

      const href = `@highlightjs/styles/${theme}.min.css`;
      if (link.getAttribute('href') === href) return;

      link.setAttribute('href', href);

      if (window.hljs) {
        document
          .querySelectorAll('pre code')
          .forEach(block => hljs.highlightElement(block));
      }
    }

    // Initial sync
    applyHighlightTheme(document.body.dataset.theme);

    // Watch for data-theme changes
    new MutationObserver(mutations => {
      for (const m of mutations) {
        if (m.attributeName === 'data-theme') {
          applyHighlightTheme(document.body.dataset.theme);
        }
      }
    }).observe(document.body, { attributes: true });
  })();
  </script>

  <!-- Reveal initialization -->
  <script>
    const config = {{CONFIG}} || {
      hash: true,
      controls: false,
      markdown: {
        smartypants: true,
        highlightCode: true
      }
    };

    // Ensure essential plugins load
    config.plugins = [
      RevealMarkdown,
      RevealHighlight,
      RevealNotes,
      RevealMath.MathJax3,  // or KaTeX
      RevealZoom
    ];

    Reveal.initialize(config);
  </script>

  <!-- Copy code button -->
  <script>
  document.querySelectorAll('.reveal pre').forEach(pre => {
    const btn = document.createElement('button');
    btn.className = 'copy-code';
    btn.textContent = 'Copy';
  
    btn.addEventListener('click', () => {
      const code = pre.querySelector('code');
      if (!code) return;
      navigator.clipboard.writeText(code.innerText);
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 1000);
    });
  
    pre.appendChild(btn);
  });
  </script>
</body>

</html>
